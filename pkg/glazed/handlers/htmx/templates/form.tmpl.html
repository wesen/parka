<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Command.Name}} - {{.Command.Short}}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body>
<div class="container py-4">
    <h1>{{.Command.Name}}</h1>
    <p class="lead">{{.Command.Short}}</p>

    {{ if .LongDescription }}
        <div class="mb-4">{{.LongDescription}}</div>
    {{ end }}

    {{ if .CommandMetadata }}
        <details class="mb-4">
            <summary>Command Metadata</summary>
            <div class="card">
                <div class="card-body">
                    {{ range $key, $value := .CommandMetadata }}
                        <p><strong>{{$key}}:</strong>
                        <pre>{{$value}}</pre></p>
                    {{ end }}
                </div>
            </div>
        </details>
    {{ end }}

    <form hx-get="submit" 
          hx-target="#results"
          hx-trigger="submit"
          hx-indicator="#spinner">
        
        {{ range $section := .Layout.Sections }}
            <div class="card mb-4 {{$section.Classes}}" {{if $section.Style}}style="{{$section.Style}}"{{end}}>
                <div class="card-body">
                    {{if $section.Title}}<h3>{{$section.Title}}</h3>{{end}}
                    {{if $section.ShortDescription}}<p>{{$section.ShortDescription}}</p>{{end}}
                        {{ if $section.LongDescription }}
                            <p>{{$section.LongDescription }}</p>
                        {{end}}

                    {{ range $row := $section.Rows }}
                        <div class="row mb-3 {{$row.Classes}}" {{if $row.Style}}style="{{$row.Style}}"{{end}}>
                            {{ range $field := $row.Inputs }}
                                <div class="col">
                                    {{ template "form-field" $field }}
                                </div>
                            {{ end }}
                        </div>
                    {{ end }}
                </div>
            </div>
        {{ end }}

        <div class="d-flex gap-2 mb-4">
            <button type="submit" class="btn btn-primary">
                Submit
            </button>
            <button type="reset" class="btn btn-secondary">
                Reset
            </button>
        </div>
    </form>

    <div id="spinner" class="htmx-indicator">
        <div class="d-flex justify-content-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <div id="results" class="mt-4">
        {{ range .ErrorStream }}
            <div class="alert alert-danger">
                <strong>Error:</strong> {{.}}
            </div>
        {{ end }}

        {{ range .ResultStream }}
            <div class="result-item">{{.}}</div>
        {{ end }}
    </div>
</div>

{{ define "form-field" }}
    <div class="form-group" 
         {{ if .Id }}id="{{.Id}}"{{end}}
         {{ if .Classes }}class="{{.Classes}}"{{end}}
         {{ if .CSS }}style="{{.CSS}}"{{end}}>
        
        {{ if eq .Type "string" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="text" class="form-control" name="{{.Name}}" value="{{.Value}}">

        {{ else if eq .Type "stringList" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="text" class="form-control" name="{{.Name}}" value='{{.Value | join "," }}'>

        {{ else if eq .Type "intList" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="text" class="form-control" name="{{.Name}}" value='{{.Value | join "," }}'>

        {{ else if eq .Type "floatList" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="text" class="form-control" name="{{.Name}}" value='{{.Value | join "," }}'>

        {{ else if eq .Type "int" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="number" class="form-control" name="{{.Name}}" value="{{.Value}}">

        {{ else if eq .Type "float" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="number" class="form-control" name="{{.Name}}" value="{{.Value}}">

        {{ else if eq .Type "bool" }}
            <div class="form-check">
                <input type="checkbox" class="form-check-input" name="{{.Name}}" {{if .Value}}checked{{end}}>
                <label class="form-check-label" for="{{.Name}}">{{.Help}}</label>
            </div>

        {{ else if eq .Type "date" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="date" class="form-control" name="{{.Name}}" {{if .Value}}value="{{.Value | toDate}}"{{end}}>

        {{ else if eq .Type "choice" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <select class="form-select" name="{{.Name}}">
                {{ $parent := . }}
                {{range $choice := .Options}}
                    <option value="{{$choice.Value}}" 
                            {{if eq $choice.Value $parent.Value}}selected{{end}}>
                        {{$choice.Label}}
                    </option>
                {{end}}
            </select>

        {{ else if eq .Type "choiceList" }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <select class="form-select" multiple name="{{.Name}}[]">
                {{ $parent := . }}
                {{range $choice := .Options}}
                    <option value="{{$choice.Value}}"
                            {{if has $choice.Value $parent.Value}}selected{{end}}>
                        {{$choice.Label}}
                    </option>
                {{end}}
            </select>

        {{ else }}
            <label class="form-label" for="{{.Name}}">{{.Help}}</label>
            <input type="text" class="form-control" name="{{.Name}}" value="{{.Value}}">
        {{ end }}
    </div>
{{ end }}

</body>
</html> 